<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2D Platformer Game</title>
    <style>
        canvas { 
            border: 1px solid black; 
            position: absolute; 
            top: 60px; 
            left: 0; 
            z-index: 2; 
            background: transparent; 
        }
        #ui { 
            font-family: Arial, sans-serif; 
            margin: 10px; 
            position: relative; 
            z-index: 3; 
        }
        #startButton, #pauseButton, #restartButton, #playAgainButton, 
        #easyButton, #normalButton, #hardButton { 
            padding: 10px 20px; 
            font-size: 16px; 
            cursor: pointer; 
            margin-right: 10px; 
        }
        #pauseButton, #restartButton, #playAgainButton, 
        #easyButton, #normalButton, #hardButton { 
            display: none; 
        }
        #background { 
            position: absolute; 
            top: 60px; 
            left: 0; 
            width: 1200px; 
            height: 600px; 
            z-index: 1; 
            background: 
                url('ground_green.png') 0 0 / 24px 514px repeat-x, /* Top to mountains */
                url('ground_mountains.png') var(--ground-mountains-offset, 0) 514px / 24px 50px repeat-x; /* Bottom at 564px */
        }
    </style>
</head>
<body>
    <div id="ui">
        <span id="level">Level: 1</span> |
        <span id="lives">Lives: -</span> |
        <span id="coins">Coins: 0</span>
        <button id="startButton">Start Game</button>
        <button id="pauseButton">Pause</button>
        <button id="restartButton">Restart</button>
        <button id="playAgainButton">Play Again</button>
        <button id="easyButton">Easy</button>
        <button id="normalButton">Normal</button>
        <button id="hardButton">Hard</button>
    </div>
    <div id="background"></div>
    <canvas id="gameCanvas" width="1200" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const restartButton = document.getElementById('restartButton');
        const playAgainButton = document.getElementById('playAgainButton');
        const easyButton = document.getElementById('easyButton');
        const normalButton = document.getElementById('normalButton');
        const hardButton = document.getElementById('hardButton');
        const levelDisplay = document.getElementById('level');
        const livesDisplay = document.getElementById('lives');
        const coinsDisplay = document.getElementById('coins');
        const backgroundDiv = document.getElementById('background');

        // Load game images
        const playerIdleImage = new Image(); playerIdleImage.src = 'player.png';
        const playerMoveImage = new Image(); playerMoveImage.src = 'player_move.png';
        const walkerIdleImage = new Image(); walkerIdleImage.src = 'walker.png';
        const walkerMoveImage = new Image(); walkerMoveImage.src = 'walker_move.png';
        const flyerIdleImage = new Image(); flyerIdleImage.src = 'flyer.png';
        const flyerMoveImage = new Image(); flyerMoveImage.src = 'flyer_move.png';
        const shooterImage = new Image(); shooterImage.src = 'shooter.png';
        const jumperIdleImage = new Image(); jumperIdleImage.src = 'jumper.png';
        const jumperMoveImage = new Image(); jumperMoveImage.src = 'jumper_move.png';
        const coinImage = new Image(); coinImage.src = 'coin.png';
        const boxImage = new Image(); boxImage.src = 'box.png';
        const spikeImage = new Image(); spikeImage.src = 'spike.png';
        const groundImage = new Image(); groundImage.src = 'ground.png';
        const platformImage = new Image(); platformImage.src = 'platform.png';
        const rockImage = new Image(); rockImage.src = 'rock.png';
        const killerPowerImage = new Image(); killerPowerImage.src = 'killer.png';
        const lifePowerImage = new Image(); lifePowerImage.src = 'life.png';
        const speedPowerImage = new Image(); speedPowerImage.src = 'fast.png';
		const lockedDoorImage = new Image(); lockedDoorImage.src = 'locked_door.png';
		const keyImage = new Image(); keyImage.src = 'key.png';
		const bigCoinImage = new Image(); bigCoinImage.src = 'big_coin.png';
		const bossIdleImage = new Image(); bossIdleImage.src = 'boss_idle.png';
		const bossMoveImage = new Image(); bossMoveImage.src = 'boss_move.png';

        // Constants
        const GRAVITY = 0.5;
        const GROUND_Y = 600;
        const GROUND_HEIGHT = 36;
        const TRANSITION_DURATION = 120;
        const PLATFORM_HEIGHT = 18;
        const KILLER_DURATION = 600;
        const SPEED_DURATION = 600;
        const JUMP_BUFFER_FRAMES = 10;
        const ANIMATION_SPEED = 10;

        // Audio setup
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(frequency, duration, type = 'sine', volume = 0.5) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = type;
            oscillator.frequency.value = frequency;
            gainNode.gain.value = volume;
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        }
        function playSweep(startFreq, endFreq, duration, type = 'sine', volume = 0.5) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = type;
            oscillator.frequency.setValueAtTime(startFreq, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(endFreq, audioCtx.currentTime + duration);
            gainNode.gain.value = volume;
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        }
        function playWinSound() {
            playTone(523.25, 0.2);
            setTimeout(() => playTone(659.25, 0.2), 200);
            setTimeout(() => playTone(783.99, 0.4), 400);
        }
        function playBackgroundMusic() {
            const notes = [261.63, 329.63, 392.00, 440.00, 392.00, 329.63, 293.66, 261.63,
                           293.66, 349.23, 440.00, 493.88, 440.00, 349.23, 329.63, 293.66];
            let index = 0;
            const melodyOsc = audioCtx.createOscillator();
            const harmonyOsc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            melodyOsc.type = 'square';
            harmonyOsc.type = 'square';
            melodyOsc.frequency.value = notes[index];
            harmonyOsc.frequency.value = notes[index] * 0.75;
            gainNode.gain.value = 0.1;
            melodyOsc.connect(gainNode);
            harmonyOsc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            melodyOsc.start();
            harmonyOsc.start();
            setInterval(() => {
                index = (index + 1) % notes.length;
                melodyOsc.frequency.setValueAtTime(notes[index], audioCtx.currentTime + 0.01);
                harmonyOsc.frequency.setValueAtTime(notes[index] * 0.75, audioCtx.currentTime + 0.01);
            }, 750);
            return { melody: melodyOsc, harmony: harmonyOsc };
        }

        // Game state
        let gameState = 'menu';
        let isPaused = false;
        let level = 1;
        let difficulty = null;
        let transitionFrames = 0;
        let hasWonSoundPlayed = false;
        let backgroundMusic = null;
        let animationFrame = 0;
        let player = { 
            x: 50, 
            y: GROUND_Y - 48 - GROUND_HEIGHT, 
            width: 48, 
            height: 48, 
            baseSpeed: 5,
            speed: 5, 
            lives: 0,
            moving: false, 
            targetX: null, 
            vy: 0, 
            grounded: false,
            hitTimer: 0,
            killerTimer: 0,
            speedTimer: 0,
            jumpBuffer: 0,
            hasJumped: false,
            movingLeft: false,
            movingRight: false,
            facingRight: true,
			keyCount: 0
        };
        let enemies = [];
        let coins = [];
        let spikes = [];
        let boxes = [];
        let platforms = [];
        let powerups = [];
		let lockedDoors = [];
		let keys = [];
        let particles = [];
        let projectiles = [];
        let rocks = [];
        let confetti = [];
        let coinCount = 0;
        let TOTAL_COINS = 0;
        let groundMountainsOffset = 0;
        let coinSpinAngle = 0;
        let powerupFloatOffset = 0;
		let boss = null; // Will hold boss object
		let bossHitTimer = 0; // For hit effect
		let powerupSpawnTimer = 0; // Timer for killer power-up spawn
		let bossInvulnTimer = 0; // Timer for boss invulnerability after hit
		let coinSpawnDelay = 0; // Delay timer for coin spawn after boss death

        // Event listeners
        startButton.addEventListener('click', () => {
            gameState = 'difficulty';
            startButton.style.display = 'none';
            easyButton.style.display = 'inline';
            normalButton.style.display = 'inline';
            hardButton.style.display = 'inline';
        });

        easyButton.addEventListener('click', () => {
            difficulty = 'easy';
            player.lives = 5;
            gameState = 'playing';
			level = 10; // Add this line
            easyButton.style.display = 'none';
            normalButton.style.display = 'none';
            hardButton.style.display = 'none';
            pauseButton.style.display = 'inline';
            resetGame();
            backgroundMusic = playBackgroundMusic();
        });

        normalButton.addEventListener('click', () => {
            difficulty = 'normal';
            player.lives = 3;
            gameState = 'playing';
			level = 10; // Add this line
            easyButton.style.display = 'none';
            normalButton.style.display = 'none';
            hardButton.style.display = 'none';
            pauseButton.style.display = 'inline';
            resetGame();
            backgroundMusic = playBackgroundMusic();
        });

        hardButton.addEventListener('click', () => {
            difficulty = 'hard';
            player.lives = 2;
            gameState = 'playing';
			level = 10; // Add this line
            easyButton.style.display = 'none';
            normalButton.style.display = 'none';
            hardButton.style.display = 'none';
            pauseButton.style.display = 'inline';
            resetGame();
            backgroundMusic = playBackgroundMusic();
        });

        pauseButton.addEventListener('click', () => {
            if (gameState !== 'playing') return;
            isPaused = !isPaused;
            pauseButton.textContent = isPaused ? 'Resume' : 'Pause';
            if (isPaused && backgroundMusic) {
                backgroundMusic.melody.stop();
                backgroundMusic.harmony.stop();
                backgroundMusic = null;
            } else if (!isPaused && !backgroundMusic) {
                backgroundMusic = playBackgroundMusic();
            }
        });

        restartButton.addEventListener('click', () => {
            level = 1;
            resetGame();
            gameState = 'playing';
            restartButton.style.display = 'none';
            pauseButton.style.display = 'inline';
            if (backgroundMusic) {
                backgroundMusic.melody.stop();
                backgroundMusic.harmony.stop();
            }
            backgroundMusic = playBackgroundMusic();
        });

        playAgainButton.addEventListener('click', () => {
            gameState = 'menu';
            level = 1;
            difficulty = null;
            player.lives = 0;
            playAgainButton.style.display = 'none';
            startButton.style.display = 'inline';
            if (backgroundMusic) {
                backgroundMusic.melody.stop();
                backgroundMusic.harmony.stop();
                backgroundMusic = null;
            }
        });

        canvas.addEventListener('click', (e) => {
            if (gameState !== 'playing' || isPaused) return;
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;

            let boxClicked = false;
            boxes.forEach(box => {
                if (!box.broken && clickX > box.x && clickX < box.x + box.width && 
                    clickY > box.y && clickY < box.y + box.height) {
                    box.broken = true;
					if (level === 10) {
						// Spawn killer power-up instead of coin on Level 10
						powerups.push({
							x: box.x + box.width / 2 - 36,
							y: box.y + box.height / 2 - 36,
							width: 72, height: 72,
							type: 'killer'
						});
					} else {
						spawnItem(box.x + box.width / 2 - 18, box.y + box.height / 2 - 18); // Coin for other levels
					}
                    spawnParticles(box.x + box.width / 2, box.y + box.height / 2);
                    playTone(300, 0.1, 'square', 0.3);
                    boxClicked = true;
                }
            });

            if (!boxClicked) {
                player.targetX = clickX;
                player.moving = true;
            }
        });

        canvas.addEventListener('dblclick', (e) => {
            if (gameState !== 'playing' || isPaused) return;
            if (player.grounded || (player.jumpBuffer > 0 && !player.hasJumped)) {
                player.vy = -15;
                player.grounded = false;
                player.jumpBuffer = 0;
                player.hasJumped = true;
                playTone(400, 0.1);
            }
        });

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (gameState !== 'playing' || isPaused) return;
            switch (e.key) {
                case 'ArrowLeft':
                    player.movingLeft = true;
                    player.moving = false;
                    player.targetX = null;
                    player.facingRight = false;
                    break;
                case 'ArrowRight':
                    player.movingRight = true;
                    player.moving = false;
                    player.targetX = null;
                    player.facingRight = true;
                    break;
                case ' ':
                    if (player.grounded || (player.jumpBuffer > 0 && !player.hasJumped)) {
                        player.vy = -15;
                        player.grounded = false;
                        player.jumpBuffer = 0;
                        player.hasJumped = true;
                        playTone(400, 0.1);
                    }
                    e.preventDefault();
                    break;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (gameState !== 'playing' || isPaused) return;
            switch (e.key) {
                case 'ArrowLeft':
                    player.movingLeft = false;
                    break;
                case 'ArrowRight':
                    player.movingRight = false;
                    break;
            }
        });

        // Game loop
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            if (gameState === 'menu' || gameState === 'difficulty') return;

            if (gameState === 'won') {
                if (!hasWonSoundPlayed) {
                    playWinSound();
                    hasWonSoundPlayed = true;
                    spawnConfetti();
                    if (backgroundMusic) {
                        backgroundMusic.melody.stop();
                        backgroundMusic.harmony.stop();
                        backgroundMusic = null;
                    }
                }
                confetti.forEach(c => {
                    c.x += c.vx;
                    c.y += c.vy;
                    c.vy += 0.1;
                    if (c.y > 600) {
                        c.y = -10;
                        c.x = Math.random() * 1200;
                    }
                });
                return;
            }

            if (isPaused) return;

            if (gameState === 'transitioning') {
                transitionFrames--;
                if (transitionFrames <= 0) {
                    if (level < 10) {
                        level++;
                        resetGame();
                        gameState = 'playing';
                        pauseButton.style.display = 'inline';
                    }
                }
                return;
            }
            if (gameState === 'gameover') {
                transitionFrames--;
                if (transitionFrames <= 0) {
                    resetGame();
                    gameState = 'playing';
                    pauseButton.style.display = 'inline';
                }
                return;
            }

            // Player movement
            let targetSpeed = 0;
            if (player.movingLeft) targetSpeed -= player.speed;
            if (player.movingRight) targetSpeed += player.speed;

            if (targetSpeed !== 0) {
                let nextX = player.x + targetSpeed;
                let collisionDetected = false;

                boxes.forEach(box => {
                    if (!box.broken && collides({ x: nextX, y: player.y, width: player.width, height: player.height }, box)) {
                        if (player.x < box.x) {
                            player.x = box.x - player.width;
                        } else {
                            player.x = box.x + box.width;
                        }
                        collisionDetected = true;
                    }
                });
				
				lockedDoors.forEach(door => {
					if (collides({ x: nextX, y: player.y, width: player.width, height: player.height }, door)) {
						if (player.x < door.x) {
							player.x = door.x - player.width;
						} else {
							player.x = door.x + door.width;
						}
						collisionDetected = true;
					}
				});

                if (!collisionDetected && nextX >= 0 && nextX + player.width <= canvas.width) {
                    player.x = nextX;
                }
            } else if (player.moving && player.targetX !== null) {
                targetSpeed = player.x < player.targetX ? player.speed : -player.speed;
                let nextX = player.x + targetSpeed;
                let collisionDetected = false;

                boxes.forEach(box => {
                    if (!box.broken && collides({ x: nextX, y: player.y, width: player.width, height: player.height }, box)) {
                        if (player.x < box.x) {
                            player.x = box.x - player.width;
                        } else {
                            player.x = box.x + box.width;
                        }
                        player.moving = false;
                        player.targetX = null;
                        collisionDetected = true;
                    }
                });
				
				lockedDoors.forEach(door => {
					if (collides({ x: nextX, y: player.y, width: player.width, height: player.height }, door)) {
						if (player.x < door.x) {
							player.x = door.x - player.width;
						} else {
							player.x = door.x + door.width;
						}
						player.moving = false;
						player.targetX = null;
						collisionDetected = true;
					}
				});

                if (!collisionDetected) {
                    if (Math.abs(player.x - player.targetX) > player.speed) {
                        player.x += targetSpeed;
                        player.facingRight = player.x < player.targetX;
                    } else {
                        player.x = player.targetX;
                        player.moving = false;
                    }
                }
            }

            // Player animation
            if (player.moving || player.movingLeft || player.movingRight) {
                animationFrame++;
            } else {
                animationFrame = 0;
            }

            // Player gravity and jumping
            player.vy += GRAVITY;
            player.y += player.vy;
            if (player.y + player.height > GROUND_Y - GROUND_HEIGHT) {
                player.y = GROUND_Y - GROUND_HEIGHT - player.height;
                player.vy = 0;
                player.grounded = true;
                player.hasJumped = false;
            } else {
                player.grounded = false;
                if (player.jumpBuffer > 0) player.jumpBuffer--;
            }

            if (!player.grounded && player.jumpBuffer === 0 && player.vy > 0 && !player.hasJumped) {
                player.jumpBuffer = JUMP_BUFFER_FRAMES;
            }

            platforms.forEach(platform => {
                if (collides(player, platform) && player.vy >= 0 && 
                    player.y + player.height - player.vy <= platform.y) {
                    player.y = platform.y - player.height;
                    player.vy = 0;
                    player.grounded = true;
                    player.hasJumped = false;
                }
            });

            boxes.forEach(box => {
                if (!box.broken && collides(player, box) && player.vy >= 0 && 
                    player.y + player.height - player.vy <= box.y) {
                    player.y = box.y - player.height;
                    player.vy = 0;
                    player.grounded = true;
                    player.hasJumped = false;
                }
            });
			
			lockedDoors.forEach(door => {
				if (collides(player, door) && player.vy >= 0 && 
					player.y + player.height - player.vy <= door.y) {
					player.y = door.y - player.height;
					player.vy = 0;
					player.grounded = true;
					player.hasJumped = false;
				}
			});

            // Enemy movement and animation
            enemies.forEach(enemy => {
                if (enemy.type === 'walker') {
                    let nextX = enemy.x + enemy.speed;
                    let collisionDetected = false;

                    boxes.forEach(box => {
                        if (!box.broken && collides({ x: nextX, y: enemy.y, width: enemy.width, height: enemy.height }, box)) {
                            if (enemy.x < box.x) enemy.speed = -Math.abs(enemy.speed);
                            else enemy.speed = Math.abs(enemy.speed);
                            collisionDetected = true;
                        }
                    });
					
					lockedDoors.forEach(door => {
						if (collides({ x: nextX, y: enemy.y, width: enemy.width, height: enemy.height }, door)) {
							if (enemy.x < door.x) enemy.speed = -Math.abs(enemy.speed);
							else enemy.speed = Math.abs(enemy.speed);
							collisionDetected = true;
						}
					});

                    if (enemy.x < 50 || enemy.x + enemy.width > 1150) {
                        enemy.speed *= -1;
                    }

                    if (!collisionDetected) {
                        enemy.x += enemy.speed;
                    }
                    enemy.facingRight = enemy.speed > 0;
                    enemy.animationFrame = (enemy.animationFrame || 0) + 1;

                } else if (enemy.type === 'flyer') {
                    enemy.x += enemy.speed;
                    enemy.y = enemy.baseY + Math.sin(enemy.x * 0.02) * 50;
                    if (enemy.x > 1200) enemy.x = -enemy.width;
                    enemy.facingRight = enemy.speed > 0;
                    enemy.animationFrame = (enemy.animationFrame || 0) + 1;

                } else if (enemy.type === 'shooter') {
                    enemy.shootTimer--;
                    if (enemy.shootTimer <= 0) {
                        projectiles.push({
                            x: enemy.x + enemy.width / 2,
                            y: enemy.y + enemy.height / 2,
                            vx: player.x < enemy.x ? -5 : 5,
                            width: 10,
                            height: 10
                        });
                        enemy.shootTimer = 90;
                    }

                } else if (enemy.type === 'jumper') {
                    let nextX = enemy.x + enemy.speed;
                    let collisionDetected = false;

                    boxes.forEach(box => {
                        if (!box.broken && collides({ x: nextX, y: enemy.y, width: enemy.width, height: enemy.height }, box)) {
                            if (enemy.x < box.x) enemy.speed = -Math.abs(enemy.speed);
                            else enemy.speed = Math.abs(enemy.speed);
                            collisionDetected = true;
                        }
                    });
					
					lockedDoors.forEach(door => {
						if (collides({ x: nextX, y: enemy.y, width: enemy.width, height: enemy.height }, door)) {
							if (enemy.x < door.x) enemy.speed = -Math.abs(enemy.speed);
							else enemy.speed = Math.abs(enemy.speed);
							collisionDetected = true;
						}
					});

                    if (enemy.x < 50 || enemy.x + enemy.width > 1150) {
                        enemy.speed *= -1;
                    }

                    if (!collisionDetected) {
                        enemy.x += enemy.speed;
                    }

                    if (enemy.jumpTimer <= 0) {
                        enemy.vy = -10;
                        enemy.jumpTimer = 60;
                    }
                    enemy.vy += GRAVITY;
                    enemy.y += enemy.vy;
                    if (enemy.y + enemy.height > GROUND_Y - GROUND_HEIGHT) {
                        enemy.y = GROUND_Y - GROUND_HEIGHT - enemy.height;
                        enemy.vy = 0;
                    }
                    enemy.jumpTimer--;
                    enemy.facingRight = enemy.speed > 0;
                    enemy.animationFrame = (enemy.animationFrame || 0) + 1;
				} else if (enemy.type === 'boss') {
					// Horizontal movement
					enemy.x += enemy.speed;
					if (enemy.x < 50 || enemy.x + enemy.width > 1150) {
						enemy.speed *= -1; // Reverse direction at screen edges
					}

					// Random jumping
					if (enemy.jumpTimer <= 0) {
						enemy.vy = -15; // Increased jump height (was -12)
						const targetPlatform = platforms[Math.floor(Math.random() * 3)]; // Random platform
						enemy.speed = (targetPlatform.x + targetPlatform.width / 2 - enemy.x - enemy.width / 2) > 0 ? 3 : -3; // Move toward platform
						enemy.jumpTimer = Math.floor(Math.random() * 60) + 60; // Random 60-120 frames
					}
					enemy.vy += GRAVITY;
					enemy.y += enemy.vy;
					// Land on platforms or ground
					let landed = false;
					platforms.forEach(platform => {
						if (collides(enemy, platform) && enemy.vy >= 0 && enemy.y + enemy.height - enemy.vy <= platform.y) {
							enemy.y = platform.y - enemy.height;
							enemy.vy = 0;
							landed = true;
						}
					});
					if (!landed && enemy.y + enemy.height > GROUND_Y - GROUND_HEIGHT) {
						enemy.y = GROUND_Y - GROUND_HEIGHT - enemy.height;
						enemy.vy = 0;
					}
					enemy.jumpTimer--;
					enemy.facingRight = enemy.speed > 0;
					enemy.animationFrame = (enemy.animationFrame || 0) + 1;
				}
            });

            // Parallax background update
            groundMountainsOffset -= 0.5;
            if (groundMountainsOffset <= -24) groundMountainsOffset += 24;
            backgroundDiv.style.setProperty('--ground-mountains-offset', `${groundMountainsOffset}px`);

            // Coin spin and power-up float animation
            coinSpinAngle += 0.1;
            powerupFloatOffset += 0.05;

            // Collision detection and timers
            if (player.hitTimer > 0) player.hitTimer--;
            if (player.killerTimer > 0) {
                player.killerTimer--;
                if (player.killerTimer === 0) {
                    spawnParticles(player.x + player.width / 2, player.y + player.height / 2);
                    playTone(200, 0.2, 'sawtooth');
                    player.speed = player.baseSpeed;
                }
            }
            if (player.speedTimer > 0) {
                player.speedTimer--;
                if (player.speedTimer === 0) {
                    spawnParticles(player.x + player.width / 2, player.y + player.height / 2, 'blue');
                    playTone(250, 0.2, 'sawtooth');
                    player.speed = player.baseSpeed;
                }
            }

            spikes.forEach(spike => {
                if (collides(player, spike) && player.lives > 0 && player.hitTimer === 0) {
                    player.lives--;
                    player.hitTimer = 60;
                    livesDisplay.textContent = `Lives: ${player.lives}`;
                    playTone(100, 0.2, 'square', 0.5);
                    if (player.lives <= 0) endGame();
                }
            });

			enemies = enemies.filter(enemy => {
				if (collides(player, enemy) && player.lives > 0) {
					if (player.killerTimer > 0) {
						if (enemy.type === 'boss') {
							if (bossInvulnTimer <= 0) { // Only damage if not invulnerable
								enemy.hp--;
								bossHitTimer = 10; // Flash for 10 frames
								bossInvulnTimer = 30; // Set invulnerability for 30 frames (0.5 seconds)
								spawnParticles(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, 'red');
								playTone(500, 0.1, 'square');
								if (enemy.hp <= 0) {
									coinSpawnDelay = 180; // Set 3-second delay (180 frames)
									console.log("Boss defeated, coin delay set to 180"); // Debug log
									return false; // Remove boss
								}
							}
							return true; // Keep boss alive, no player damage
						} else {
							spawnParticles(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2);
							playTone(500, 0.1, 'square');
							return false; // Non-boss enemies die instantly
						}
					} else if (player.hitTimer === 0) {
						player.lives--;
						player.hitTimer = 60;
						livesDisplay.textContent = `Lives: ${player.lives}`;
						playTone(100, 0.2, 'square', 0.5);
						if (player.lives <= 0) endGame();
					}
				}
				return true;
			});
			
			// Spawn big coin after delay on center platform
			if (level === 10 && coinSpawnDelay > 0) {
				coinSpawnDelay--;
				if (coinSpawnDelay <= 0) {
					coins.push({
						x: 546 + 108 / 2 - 36, // Center of middle platform (x: 546, width: 108)
						y: 346 - 72, // Top of middle platform (y: 346, height: 72)
						width: 72, height: 72,
						isBig: true
					});
				}
			}

            coins = coins.filter(coin => {
                if (collides(player, coin)) {
                    coinCount++;
                    coinsDisplay.textContent = `Coins: ${coinCount}`;
                    playSweep(600, 800, 0.1);
                    spawnParticles(coin.x + coin.width / 2, coin.y + coin.height / 2, 'yellow');
                    return false;
                }
                return true;
            });

            powerups.forEach(power => {
                power.baseY = power.baseY || power.y;
                power.y = power.baseY + Math.sin(powerupFloatOffset) * 10;
            });

            powerups = powerups.filter(power => {
                if (collides(player, power)) {
                    if (power.type === 'killer') {
                        player.killerTimer = KILLER_DURATION;
                        spawnParticles(player.x + player.width / 2, player.y + player.height / 2);
                        playSweep(400, 600, 0.2, 'sawtooth');
                    } else if (power.type === 'life') {
                        player.lives++;
                        livesDisplay.textContent = `Lives: ${player.lives}`;
                        playSweep(300, 500, 0.2);
                    } else if (power.type === 'speed') {
                        player.speedTimer = SPEED_DURATION;
                        player.speed = player.baseSpeed * 2;
                        spawnParticles(player.x + player.width / 2, player.y + player.height / 2, 'blue');
                        playSweep(500, 700, 0.2, 'sawtooth');
                    }
                    return false;
                }
                return true;
            });
			
			keys = keys.filter(key => {
				if (collides(player, key)) {
					player.keyCount++;
					playSweep(700, 900, 0.1);
					spawnParticles(key.x + key.width / 2, key.y + key.height / 2, 'gold');
					
					if (level === 8) {
						if (player.keyCount === 1) {
							lockedDoors = lockedDoors.filter(door => 
								!(door.x === 714 && door.y === GROUND_Y - 36 - GROUND_HEIGHT) &&
								!(door.x === 750 && door.y === GROUND_Y - 72 - GROUND_HEIGHT) &&
								!(door.x === 786 && door.y === GROUND_Y - 36 - GROUND_HEIGHT)
							);
						} else if (player.keyCount === 2) {
							lockedDoors = lockedDoors.filter(door => 
								!(door.x === 1014 && door.y === 230) &&
								!(door.x === 1050 && door.y === 194) &&
								!(door.x === 1086 && door.y === 230)
							);
						}
					} else if (level === 9) {
						if (difficulty === 'easy' && player.keyCount === 1) {
							lockedDoors = lockedDoors.filter(door => 
								!(door.x === 1014 && door.y === 230) &&
								!(door.x === 1050 && door.y === 194) &&
								!(door.x === 1086 && door.y === 230)
							);
						} else if (difficulty === 'normal') {
							if (player.keyCount === 1) {
								lockedDoors = lockedDoors.filter(door => 
									!(door.x === 714 && door.y === GROUND_Y - 72 - GROUND_HEIGHT) &&
									!(door.x === 750 && door.y === GROUND_Y - 108 - GROUND_HEIGHT)
								);
							} else if (player.keyCount === 2) {
								lockedDoors = lockedDoors.filter(door => 
									!(door.x === 1014 && door.y === 230) &&
									!(door.x === 1050 && door.y === 194) &&
									!(door.x === 1086 && door.y === 230)
								);
							}
						} else if (difficulty === 'hard') {
							if (player.keyCount === 1) {
								lockedDoors = lockedDoors.filter(door => 
									!(door.x === 714 && door.y === GROUND_Y - 72 - GROUND_HEIGHT) &&
									!(door.x === 750 && door.y === GROUND_Y - 108 - GROUND_HEIGHT)
								);
							} else if (player.keyCount === 2) {
								lockedDoors = lockedDoors.filter(door => 
									!(door.x === 600 && door.y === 310)
								);
							} else if (player.keyCount === 3) {
								lockedDoors = lockedDoors.filter(door => 
									!(door.x === 1014 && door.y === 230) &&
									!(door.x === 1050 && door.y === 194) &&
									!(door.x === 1086 && door.y === 230)
								);
							}
						} else {
							lockedDoors = []; // For levels 6 and 7
						}
					} else {
						lockedDoors = []; // For levels 6 and 7
					}
					
					return false;
				}
				return true;
			});

			projectiles = projectiles.filter(projectile => {
				projectile.x += projectile.vx;
				if (collides(player, projectile) && player.hitTimer === 0 && player.lives > 0) {
					player.lives--;
					player.hitTimer = 60;
					livesDisplay.textContent = `Lives: ${player.lives}`;
					playTone(100, 0.2, 'square', 0.5);
					if (player.lives <= 0) endGame();
					return false;
				}
				for (let box of boxes) {
					if (!box.broken && collides(projectile, box)) {
						return false; // Remove projectile if it hits an unbroken box
					}
				}
				for (let door of lockedDoors) {
					if (collides(projectile, door)) {
						return false; // Remove projectile if it hits a locked door
					}
				}
				return projectile.x > 0 && projectile.x < 1200;
			});

            rocks = rocks.filter(rock => {
                rock.y += rock.vy;
                if (collides(player, rock) && player.hitTimer === 0 && player.lives > 0) {
                    player.lives--;
                    player.hitTimer = 60;
                    livesDisplay.textContent = `Lives: ${player.lives}`;
                    playTone(100, 0.2, 'square', 0.5);
                    if (player.lives <= 0) endGame();
                    return false;
                }
                return rock.y < GROUND_Y + 20;
            });
			
			// Boss hit effect timer
			if (bossHitTimer > 0) bossHitTimer--;
			
			// Boss hit effect timer
			if (bossHitTimer > 0) bossHitTimer--;
			if (bossInvulnTimer > 0) bossInvulnTimer--; // Add this line

			// Killer power-up spawn timer
			if (level === 10 && powerups.length === 0) {
				// ... (rest unchanged)
			}

			// Box spawn timer for killer power-up
			console.log("Pre-check - level:", level, "boxes.length:", boxes.length, "killerTimer:", player.killerTimer, "spawnTimer:", powerupSpawnTimer);
			if (level === 10 && boxes.length === 0 && player.killerTimer <= 0) {
				console.log("Box spawn check - boxes:", boxes.length, "killerTimer:", player.killerTimer, "spawnTimer:", powerupSpawnTimer);
				if (powerupSpawnTimer <= 0) {
					boxes.push({
						x: Math.random() * (canvas.width - 36),
						y: GROUND_Y - 36 - GROUND_HEIGHT,
						width: 36, height: 36,
						broken: false
					});
					powerupSpawnTimer = Math.floor(Math.random() * 300) + 300; // 5-10 seconds (300-600 frames)
					console.log("Box spawned, new spawnTimer:", powerupSpawnTimer);
				} else {
					powerupSpawnTimer--;
				}
			}
			
			// Remove broken boxes
			boxes = boxes.filter(box => !box.broken);

			if (level === 3 && Math.random() < (difficulty === 'easy' ? 0.01 : difficulty === 'normal' ? 0.02 : 0.03)) {
				rocks.push({
					x: Math.random() * 1160 + 20,
					y: -20,
					vy: difficulty === 'easy' ? 2 : difficulty === 'normal' ? 3 : 4,
					width: 36,
					height: 36
				});
			}
			if (level === 5 && Math.random() < (difficulty === 'easy' ? 0.005 : difficulty === 'normal' ? 0.01 : 0.015)) {
				rocks.push({
					x: Math.random() * 1160 + 20,
					y: -20,
					vy: difficulty === 'easy' ? 2 : difficulty === 'normal' ? 3 : 4,
					width: 36,
					height: 36
				});
			}
			if (level === 9 && Math.random() < (difficulty === 'easy' ? 0.005 : difficulty === 'normal' ? 0.01 : 0.02)) {
				rocks.push({
					x: Math.random() * 1160 + 20,
					y: -20,
					vy: difficulty === 'easy' ? 2 : difficulty === 'normal' ? 3 : 5,
					width: 36,
					height: 36
				});
			}
			if (level === 10 && Math.random() < (difficulty === 'easy' ? 0.01 : difficulty === 'normal' ? 0.015 : 0.025)) {
				rocks.push({
					x: Math.random() * 1160 + 20,
					y: -20,
					vy: difficulty === 'easy' ? 2 : difficulty === 'normal' ? 3 : 5,
					width: 36,
					height: 36
				});
			}
			
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life--;
                return p.life > 0;
            });

            if (coinCount >= TOTAL_COINS && gameState === 'playing') {
                if (level < 10) {
                    transitionToNextLevel();
                } else {
                    gameState = 'won';
                }
            }
		}

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (gameState === 'menu') {
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.fillText('Click Start Game to Begin', 400, 300);
                return;
            }

            if (gameState === 'difficulty') {
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.fillText('Select Difficulty', 480, 200);
                return;
            }

            if (gameState === 'transitioning') {
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.fillText(`Level ${level} Complete!`, 450, 300);
                return;
            }
            if (gameState === 'gameover') {
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.fillText('Game Over', 550, 300);
                restartButton.style.display = 'inline';
                return;
            }
            if (isPaused) {
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.fillText('Paused', 550, 300);
                return;
            }
            if (gameState === 'won') {
                ctx.fillStyle = 'black';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '40px Arial';
                ctx.fillText('YOU DID IT!', 500, 300);
                playAgainButton.style.display = 'inline';
                confetti.forEach(c => {
                    ctx.fillStyle = c.color;
                    ctx.fillRect(c.x, c.y, 5, 5);
                });
                return;
            }

            // Draw ground tiles
            if (groundImage.complete) {
                for (let x = 0; x < canvas.width; x += 36) {
                    ctx.drawImage(groundImage, x, GROUND_Y - GROUND_HEIGHT, 36, 36);
                }
            } else {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(0, GROUND_Y - GROUND_HEIGHT, canvas.width, GROUND_HEIGHT);
            }

            // Draw platforms
            platforms.forEach(platform => {
                if (platformImage.complete) {
                    for (let x = platform.x; x < platform.x + platform.width; x += 36) {
                        ctx.drawImage(platformImage, x, platform.y, 36, 36);
                    }
                } else {
                    ctx.fillStyle = '#666633';
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                }
            });

            // Draw power-up timers
            let yOffset = 10;
            if (player.killerTimer > 0 && killerPowerImage.complete) {
                ctx.drawImage(killerPowerImage, 10, yOffset, 72, 72);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText(Math.ceil(player.killerTimer / 60), 90, yOffset + 40);
                yOffset += 80;
            }
            if (player.speedTimer > 0 && speedPowerImage.complete) {
                ctx.drawImage(speedPowerImage, 10, yOffset, 32, 32);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText(Math.ceil(player.speedTimer / 60), 50, yOffset + 20);
            }

            // Draw player with corrected blinking
            if (playerIdleImage.complete && playerMoveImage.complete) {
                ctx.save();
                let currentImage = playerIdleImage;
                const isMoving = player.moving || player.movingLeft || player.movingRight;

                if (isMoving) {
                    currentImage = (Math.floor(animationFrame / ANIMATION_SPEED) % 2 === 0) ? playerIdleImage : playerMoveImage;
                }

                if (player.hitTimer > 0 && player.hitTimer % 10 < 5) {
                    ctx.globalAlpha = 0.5; // Blink effect
                }

                if (player.facingRight) {
                    ctx.scale(-1, 1);
                    ctx.drawImage(currentImage, -player.x - player.width, player.y, player.width, player.height);
                } else {
                    ctx.drawImage(currentImage, player.x, player.y, player.width, player.height);
                }

                ctx.globalAlpha = 1.0; // Reset alpha
                ctx.restore();
            } else {
                ctx.fillStyle = player.hitTimer > 0 && player.hitTimer % 10 < 5 ? 'white' : (player.moving || player.movingLeft || player.movingRight ? 'blue' : 'red');
                ctx.fillRect(player.x, player.y, player.width, player.height);
            }

            // Draw power-up indicators
            const pulseScale = 1 + Math.sin(Date.now() * 0.005) * 0.1;
            if (player.killerTimer > 0 && killerPowerImage.complete) {
                ctx.save();
                ctx.translate(player.x + player.width / 2, player.y - 28);
                ctx.scale(pulseScale, pulseScale);
                ctx.drawImage(killerPowerImage, -12, -12, 24, 24);
                ctx.restore();
            }
            if (player.speedTimer > 0 && speedPowerImage.complete) {
                ctx.save();
                ctx.translate(player.x + player.width / 2, player.y - 28);
                ctx.scale(pulseScale, pulseScale);
                ctx.drawImage(speedPowerImage, -12, -12, 24, 24);
                ctx.restore();
            }

            // Draw enemies
			enemies.forEach(enemy => {
				ctx.save();
				let idleImage, moveImage;
				switch (enemy.type) {
					case 'walker':
						idleImage = walkerIdleImage;
						moveImage = walkerMoveImage;
						break;
					case 'flyer':
						idleImage = flyerIdleImage;
						moveImage = flyerMoveImage;
						break;
					case 'shooter':
						idleImage = shooterImage;
						moveImage = shooterImage;
						break;
					case 'jumper':
						idleImage = jumperIdleImage;
						moveImage = jumperMoveImage;
						break;
					case 'boss':
						idleImage = bossIdleImage;
						moveImage = bossMoveImage;
						break;
				}

				if (idleImage.complete && moveImage.complete) {
					let currentImage = idleImage;
					if (enemy.type !== 'shooter' && enemy.animationFrame > 0) {
						currentImage = (Math.floor(enemy.animationFrame / ANIMATION_SPEED) % 2 === 0) ? idleImage : moveImage;
					}
					if (enemy.type === 'boss' && bossHitTimer > 0 && bossHitTimer % 4 < 2) {
						ctx.globalCompositeOperation = 'source-atop'; // Blend red over sprite
						ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
					}
					if (enemy.facingRight && enemy.type !== 'shooter') {
						ctx.scale(-1, 1);
						ctx.drawImage(currentImage, -enemy.x - enemy.width, enemy.y, enemy.width, enemy.height);
					} else {
						ctx.drawImage(currentImage, enemy.x, enemy.y, enemy.width, enemy.height);
					}
					if (enemy.type === 'boss' && bossHitTimer > 0 && bossHitTimer % 4 < 2) {
						ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
						ctx.globalCompositeOperation = 'source-over'; // Reset to default
					}
				} else {
					ctx.fillStyle = enemy.type === 'walker' ? 'green' : (enemy.type === 'flyer' ? 'purple' : (enemy.type === 'shooter' ? 'orange' : (enemy.type === 'jumper' ? 'pink' : 'darkred')));
					ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
				}
				ctx.restore();
			});

            // Draw coins
			coins.forEach(coin => {
				if (coin.isBig && bigCoinImage.complete) {
					ctx.save();
					ctx.translate(coin.x + coin.width / 2, coin.y + coin.height / 2);
					ctx.scale(Math.abs(Math.cos(coinSpinAngle)), 1);
					ctx.drawImage(bigCoinImage, -coin.width / 2, -coin.height / 2, coin.width, coin.height);
					ctx.restore();
				} else if (coinImage.complete) {
					ctx.save();
					ctx.translate(coin.x + coin.width / 2, coin.y + coin.height / 2);
					ctx.scale(Math.abs(Math.cos(coinSpinAngle)), 1);
					ctx.drawImage(coinImage, -coin.width / 2, -coin.height / 2, coin.width, coin.height);
					ctx.restore();
				} else {
					ctx.fillStyle = 'yellow';
					ctx.beginPath();
					ctx.arc(coin.x + coin.width / 2, coin.y + coin.height / 2, coin.width / 2, 0, Math.PI * 2);
					ctx.fill();
				}
			});

            // Draw spikes
            spikes.forEach(spike => {
                if (spikeImage.complete) {
                    ctx.drawImage(spikeImage, spike.x, spike.y, spike.width, spike.height);
                } else {
                    ctx.fillStyle = 'gray';
                    ctx.beginPath();
                    ctx.moveTo(spike.x + spike.width / 2, spike.y);
                    ctx.lineTo(spike.x, spike.y + spike.height);
                    ctx.lineTo(spike.x + spike.width, spike.y + spike.height);
                    ctx.closePath();
                    ctx.fill();
                }
            });

            // Draw boxes
            boxes.forEach(box => {
                if (!box.broken && boxImage.complete) {
                    ctx.drawImage(boxImage, box.x, box.y, box.width, box.height);
                } else if (!box.broken) {
                    ctx.fillStyle = 'brown';
                    ctx.fillRect(box.x, box.y, box.width, box.height);
                }
            });
			
			lockedDoors.forEach(door => {
				if (lockedDoorImage.complete) {
					ctx.drawImage(lockedDoorImage, door.x, door.y, door.width, door.height);
				} else {
					ctx.fillStyle = 'gray';
					ctx.fillRect(door.x, door.y, door.width, door.height);
				}
			});

			keys.forEach(key => {
				if (keyImage.complete) {
					ctx.drawImage(keyImage, key.x, key.y, key.width, key.height);
				} else {
					ctx.fillStyle = 'gold';
					ctx.fillRect(key.x, key.y, key.width, key.height);
				}
			});

            // Draw power-ups
            powerups.forEach(power => {
                if (power.type === 'killer' && killerPowerImage.complete) {
                    ctx.drawImage(killerPowerImage, power.x, power.y, power.width, power.height);
                } else if (power.type === 'life' && lifePowerImage.complete) {
                    ctx.drawImage(lifePowerImage, power.x, power.y, power.width, power.height);
                } else if (power.type === 'speed' && speedPowerImage.complete) {
                    ctx.drawImage(speedPowerImage, power.x, power.y, power.width, power.height);
                } else {
                    ctx.fillStyle = power.type === 'killer' ? 'purple' : (power.type === 'life' ? 'green' : 'blue');
                    ctx.fillRect(power.x, power.y, power.width, power.height);
                }
            });

            // Draw projectiles
            projectiles.forEach(projectile => {
                ctx.fillStyle = 'red';
                ctx.fillRect(projectile.x, projectile.y, projectile.width, projectile.height);
            });

            // Draw rocks
            rocks.forEach(rock => {
                if (rockImage.complete) {
                    ctx.drawImage(rockImage, rock.x, rock.y, rock.width, rock.height);
                } else {
                    ctx.fillStyle = 'gray';
                    ctx.fillRect(rock.x, rock.y, rock.width, rock.height);
                }
            });

            // Draw particles
            particles.forEach(p => {
                ctx.fillStyle = p.color || 'brown';
                ctx.fillRect(p.x, p.y, 5, 5);
            });
        }

        function collides(a, b) {
            return a.x < b.x + b.width && a.x + a.width > b.x &&
                   a.y < b.y + b.height && a.y + a.height > b.y;
        }

        function spawnItem(x, y) {
            coins.push({ x, y, width: 36, height: 36 });
        }

        function spawnParticles(x, y, color = 'brown') {
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: (Math.random() - 0.5) * 4 - 2,
                    life: 20,
                    color: color
                });
            }
        }

        function spawnConfetti() {
            confetti = [];
            for (let i = 0; i < 100; i++) {
                confetti.push({
                    x: Math.random() * 1200,
                    y: Math.random() * 100 - 100,
                    vx: (Math.random() - 0.5) * 2,
                    vy: Math.random() * 2 + 1,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`
                });
            }
        }

        function endGame() {
            gameState = 'gameover';
            transitionFrames = TRANSITION_DURATION;
            if (backgroundMusic) {
                backgroundMusic.melody.stop();
                backgroundMusic.harmony.stop();
                backgroundMusic = null;
            }
        }

        function transitionToNextLevel() {
            gameState = 'transitioning';
            transitionFrames = TRANSITION_DURATION;
            player.speed = player.baseSpeed;
            player.speedTimer = 0;
            player.killerTimer = 0;
			player.keyCount = 0;
        }

        function resetGame() {
            player.x = 50;
            player.y = GROUND_Y - 48 - GROUND_HEIGHT;
            player.vy = 0;
            player.grounded = false;
            player.moving = false;
            player.targetX = null;
            player.hitTimer = 0;
            player.killerTimer = 0;
            player.speedTimer = 0;
            player.speed = player.baseSpeed;
            player.jumpBuffer = 0;
            player.hasJumped = false;
            player.movingLeft = false;
            player.movingRight = false;
            player.facingRight = true;
			player.keyCount = 0;

            if (difficulty === 'easy') {
                player.lives = 5;
                if (level === 1) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 1, type: 'walker', facingRight: true, animationFrame: 0 }
                    ];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 250, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					lockedDoors = [];
					keys = [];
                    spikes = [];
                    boxes = [
                        { x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [];
                    powerups = [
                        { x: 450, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
                    ];
                    TOTAL_COINS = 4;
                } else if (level === 2) {
                    enemies = [
                        { x: 300, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 200, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 300, y: 408, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 250, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 300, y: 376, width: 32, height: 32, type: 'speed' }
                    ];
                    TOTAL_COINS = 3;
                } else if (level === 3) {
                    enemies = [
                        { x: 250, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 700, y: 400, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 120 }
                    ];
                    coins = [
                        { x: 200, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 350, y: 408, width: 36, height: 36 },
                        { x: 650, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 650, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
                    ];
                    TOTAL_COINS = 4;
                } else if (level === 4) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 750, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: -1, type: 'shooter', shootTimer: 120 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 350, y: 408, width: 36, height: 36 },
                        { x: 550, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 350, y: 360, width: 32, height: 32, type: 'life' }
                    ];
                    TOTAL_COINS = 4;
                } else if (level === 5) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 1, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 350, y: 350, width: 48, height: 48, speed: 2, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
                        { x: 800, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 120 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 250, y: 408, width: 36, height: 36 },
                        { x: 400, y: 328, width: 36, height: 36 },
                        { x: 650, y: 248, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 300, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 200, y: 426, width: 108, height: PLATFORM_HEIGHT },
                        { x: 350, y: 346, width: 144, height: PLATFORM_HEIGHT },
                        { x: 600, y: 266, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 400, y: 300, width: 32, height: 32, type: 'speed' }
                    ];
                    TOTAL_COINS = 5;
                } else if (level === 6) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 1, type: 'walker', facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					spikes = [];
					boxes = [
						{ x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [];
					powerups = [
						{ x: 300, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
					];
					lockedDoors = [
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					keys = [
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					TOTAL_COINS = 3;
				} else if (level === 7) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 1, type: 'walker', facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 350, y: 408, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					spikes = [
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 350, y: 376, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						{ x: 864, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 936, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - GROUND_HEIGHT, width: 36, height: 36 }
					];
					keys = [
						{ x: 200, y: 390, width: 36, height: 36 }
					];
					TOTAL_COINS = 4;
				} else if (level === 8) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 1, type: 'walker', facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }, // Ground coin
						{ x: 1050, y: 230, width: 36, height: 36 } // Elevated coin
					];
					spikes = [
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT },
						{ x: 750, y: 346, width: 108, height: PLATFORM_HEIGHT },
						{ x: 1000, y: 266, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 750, y: 300, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						// Ground-level doors (around coin at x: 750)
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						// Elevated doors (around coin at x: 1050, y: 230)
						{ x: 1014, y: 230, width: 36, height: 36 },
						{ x: 1050, y: 194, width: 36, height: 36 },
						{ x: 1086, y: 230, width: 36, height: 36 }
					];
					keys = [
						{ x: 350, y: 390, width: 36, height: 36 }, // First key (unlocks ground doors)
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 } // Second key (unlocks elevated doors)
					];
					TOTAL_COINS = 4; // 3 coins + 1 from box
				} else if (level === 9) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 1, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 600, y: 350, width: 48, height: 48, speed: 2, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 450, y: 408, width: 36, height: 36 },
						{ x: 1050, y: 230, width: 36, height: 36 }
					];
					spikes = [
						{ x: 300, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 400, y: 426, width: 108, height: PLATFORM_HEIGHT },
						{ x: 600, y: 346, width: 144, height: PLATFORM_HEIGHT },
						{ x: 1000, y: 266, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 450, y: 376, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						{ x: 1014, y: 230, width: 36, height: 36 },
						{ x: 1050, y: 194, width: 36, height: 36 },
						{ x: 1086, y: 230, width: 36, height: 36 }
					];
					keys = [
						{ x: 700, y: 310, width: 36, height: 36 }
					];
					TOTAL_COINS = 4; // 3 coins + 1 from box
				} else if (level === 10) {
					boss = {
						x: 550, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 72, height: 72,
						speed: 3, type: 'boss', jumpTimer: 60, vy: 0, hp: 5, facingRight: true, animationFrame: 0
					};
					enemies = [boss];
					coins = [];
					spikes = [];
					boxes = [];
					platforms = [
						{ x: 200, y: 426, width: 108, height: PLATFORM_HEIGHT }, // Left
						{ x: 546, y: 346, width: 108, height: PLATFORM_HEIGHT }, // Middle
						{ x: 892, y: 426, width: 108, height: PLATFORM_HEIGHT }  // Right
					];
					powerups = [];
					lockedDoors = [];
					keys = [];
					rocks = [];
					powerupSpawnTimer = 0; 
					TOTAL_COINS = 1; // Big coin after boss defeat
				}
            } else if (difficulty === 'normal') {
                player.lives = 3;
                if (level === 1) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 650, y: 350, width: 48, height: 48, speed: 3, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 250, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 350, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [];
                    powerups = [
                        { x: 450, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
                    ];
                    TOTAL_COINS = 4;
                } else if (level === 2) {
                    enemies = [
                        { x: 300, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 700, y: 320, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 320, facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 200, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 300, y: 408, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 250, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 300, y: 376, width: 32, height: 32, type: 'speed' }
                    ];
                    TOTAL_COINS = 3;
                } else if (level === 3) {
                    enemies = [
                        { x: 250, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 700, y: 400, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 60 },
                        { x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'jumper', jumpTimer: 30, vy: 0, facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 200, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 350, y: 408, width: 36, height: 36 },
                        { x: 650, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false },
                        { x: 800, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 650, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
                    ];
                    TOTAL_COINS = 5;
                } else if (level === 4) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 750, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: -2, type: 'shooter', shootTimer: 60 },
                        { x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'jumper', jumpTimer: 45, vy: 0, facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 350, y: 408, width: 36, height: 36 },
                        { x: 550, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false },
                        { x: 850, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 350, y: 360, width: 32, height: 32, type: 'life' }
                    ];
                    TOTAL_COINS = 5;
                } else if (level === 5) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 350, y: 350, width: 48, height: 48, speed: 3, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
                        { x: 800, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 90 },
                        { x: 1000, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: -3, type: 'jumper', jumpTimer: 60, vy: 0, facingRight: false, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 250, y: 408, width: 36, height: 36 },
                        { x: 400, y: 328, width: 36, height: 36 },
                        { x: 650, y: 248, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 300, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 550, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false },
                        { x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 200, y: 426, width: 108, height: PLATFORM_HEIGHT },
                        { x: 350, y: 346, width: 144, height: PLATFORM_HEIGHT },
                        { x: 600, y: 266, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 400, y: 300, width: 32, height: 32, type: 'speed' }
                    ];
                    TOTAL_COINS = 6;
                } else if (level === 6) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					spikes = [
						{ x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [];
					powerups = [
						{ x: 300, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
					];
					lockedDoors = [
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - GROUND_HEIGHT, width: 36, height: 36 }
					];
					keys = [
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					TOTAL_COINS = 3;
				} else if (level === 7) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 650, y: 350, width: 48, height: 48, speed: 3, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 350, y: 408, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					spikes = [
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 350, y: 376, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						{ x: 864, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 936, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 828, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					keys = [
						{ x: 200, y: 390, width: 36, height: 36 }
					];
					TOTAL_COINS = 4;
				} else if (level === 8) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 650, y: 350, width: 48, height: 48, speed: 3, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }, // Ground coin
						{ x: 1050, y: 230, width: 36, height: 36 } // Elevated coin
					];
					spikes = [
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT },
						{ x: 750, y: 346, width: 108, height: PLATFORM_HEIGHT },
						{ x: 1000, y: 266, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 750, y: 300, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						// Ground-level doors (around coin at x: 750)
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						// Elevated doors (around coin at x: 1050, y: 230)
						{ x: 1014, y: 230, width: 36, height: 36 },
						{ x: 1050, y: 194, width: 36, height: 36 },
						{ x: 1086, y: 230, width: 36, height: 36 }
					];
					keys = [
						{ x: 350, y: 390, width: 36, height: 36 }, // First key (unlocks ground doors)
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 } // Second key (unlocks elevated doors)
					];
					TOTAL_COINS = 4; // 3 coins + 1 from box
				} else if (level === 9) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 600, y: 350, width: 48, height: 48, speed: 3, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
						{ x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 90 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 450, y: 408, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 1050, y: 230, width: 36, height: 36 }
					];
					spikes = [
						{ x: 300, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 400, y: 426, width: 72, height: PLATFORM_HEIGHT },
						{ x: 600, y: 346, width: 108, height: PLATFORM_HEIGHT },
						{ x: 1000, y: 266, width: 72, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 450, y: 376, width: 32, height: 32, type: 'speed' },
						{ x: 650, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
					];
					lockedDoors = [
						{ x: 714, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 1014, y: 230, width: 36, height: 36 },
						{ x: 1050, y: 194, width: 36, height: 36 },
						{ x: 1086, y: 230, width: 36, height: 36 }
					];
					keys = [
						{ x: 300, y: 390, width: 36, height: 36 }, // Unlocks ground doors
						{ x: 650, y: 310, width: 36, height: 36 }  // Unlocks elevated doors
					];
					TOTAL_COINS = 5; // 4 coins + 1 from box
				} else if (level === 10) {
					boss = {
						x: 550, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 72, height: 72,
						speed: 3, type: 'boss', jumpTimer: 60, vy: 0, hp: 7, facingRight: true, animationFrame: 0
					};
					enemies = [boss];
					coins = [];
					spikes = [];
					boxes = [];
					platforms = [
						{ x: 200, y: 426, width: 108, height: PLATFORM_HEIGHT }, // Left
						{ x: 546, y: 346, width: 108, height: PLATFORM_HEIGHT }, // Middle
						{ x: 892, y: 426, width: 108, height: PLATFORM_HEIGHT }  // Right
					];
					powerups = [];
					lockedDoors = [];
					keys = [];
					rocks = [];
					powerupSpawnTimer = 0; 
					TOTAL_COINS = 1;
				}
            } else if (difficulty === 'hard') {
                player.lives = 2;
                if (level === 1) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 650, y: 350, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
                        { x: 400, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'jumper', jumpTimer: 60, vy: 0, facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 250, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 350, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [];
                    powerups = [
                        { x: 450, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
                    ];
                    TOTAL_COINS = 4;
                } else if (level === 2) {
                    enemies = [
                        { x: 300, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 4, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 700, y: 320, width: 48, height: 48, speed: 5, type: 'flyer', baseY: 320, facingRight: true, animationFrame: 0 },
                        { x: 500, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 60 }
                    ];
                    coins = [
                        { x: 200, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 300, y: 408, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 250, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 300, y: 376, width: 32, height: 32, type: 'speed' }
                    ];
                    TOTAL_COINS = 3;
                } else if (level === 3) {
                    enemies = [
                        { x: 250, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 4, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 700, y: 400, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 45 },
                        { x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'jumper', jumpTimer: 30, vy: 0, facingRight: true, animationFrame: 0 },
                        { x: 500, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 2, type: 'walker', facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 200, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 350, y: 408, width: 36, height: 36 },
                        { x: 650, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 550, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false },
                        { x: 800, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 650, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
                    ];
                    TOTAL_COINS = 5;
                } else if (level === 4) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 4, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 750, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: -3, type: 'shooter', shootTimer: 45 },
                        { x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 4, type: 'jumper', jumpTimer: 45, vy: 0, facingRight: true, animationFrame: 0 },
                        { x: 600, y: 350, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 350, y: 408, width: 36, height: 36 },
                        { x: 550, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 700, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false },
                        { x: 850, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 350, y: 360, width: 32, height: 32, type: 'life' }
                    ];
                    TOTAL_COINS = 5;
                } else if (level === 5) {
                    enemies = [
                        { x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
                        { x: 350, y: 350, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
                        { x: 800, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 60 },
                        { x: 1000, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: -4, type: 'jumper', jumpTimer: 45, vy: 0, facingRight: false, animationFrame: 0 },
                        { x: 500, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 }
                    ];
                    coins = [
                        { x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 250, y: 408, width: 36, height: 36 },
                        { x: 400, y: 328, width: 36, height: 36 },
                        { x: 650, y: 248, width: 36, height: 36 }
                    ];
                    spikes = [
                        { x: 300, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 550, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
                        { x: 700, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
                    ];
                    boxes = [
                        { x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false },
                        { x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
                    ];
                    platforms = [
                        { x: 200, y: 426, width: 108, height: PLATFORM_HEIGHT },
                        { x: 350, y: 346, width: 144, height: PLATFORM_HEIGHT },
                        { x: 600, y: 266, width: 108, height: PLATFORM_HEIGHT }
                    ];
                    powerups = [
                        { x: 400, y: 300, width: 32, height: 32, type: 'speed' }
                    ];
                    TOTAL_COINS = 6;
                } else if (level === 6) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					spikes = [
						{ x: 400, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [];
					powerups = [
						{ x: 300, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
					];
					lockedDoors = [
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - GROUND_HEIGHT, width: 36, height: 36 }
					];
					keys = [
						{ x: 650, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					TOTAL_COINS = 3;
				} else if (level === 7) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 650, y: 350, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 350, y: 408, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					spikes = [
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT },
						{ x: 700, y: 346, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 350, y: 376, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						{ x: 864, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 936, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 900, y: GROUND_Y - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 828, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					keys = [
						{ x: 750, y: 310, width: 36, height: 36 }
					];
					TOTAL_COINS = 4;
				} else if (level === 8) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 650, y: 350, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
						{ x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 60 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }, // Ground coin
						{ x: 1050, y: 230, width: 36, height: 36 } // Elevated coin
					];
					spikes = [
						{ x: 450, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 600, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 850, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 500, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 300, y: 426, width: 108, height: PLATFORM_HEIGHT },
						{ x: 750, y: 346, width: 108, height: PLATFORM_HEIGHT },
						{ x: 1000, y: 266, width: 108, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 750, y: 300, width: 32, height: 32, type: 'speed' }
					];
					lockedDoors = [
						// Ground-level doors (around coin at x: 750)
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						// Elevated doors (around coin at x: 1050, y: 230)
						{ x: 1014, y: 230, width: 36, height: 36 },
						{ x: 1050, y: 194, width: 36, height: 36 },
						{ x: 1086, y: 230, width: 36, height: 36 }
					];
					keys = [
						{ x: 350, y: 390, width: 36, height: 36 }, // First key (unlocks ground doors)
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 } // Second key (unlocks elevated doors)
					];
					TOTAL_COINS = 4; // 3 coins + 1 from box
				} else if (level === 9) {
					enemies = [
						{ x: 200, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 3, type: 'walker', facingRight: true, animationFrame: 0 },
						{ x: 600, y: 350, width: 48, height: 48, speed: 4, type: 'flyer', baseY: 350, facingRight: true, animationFrame: 0 },
						{ x: 900, y: GROUND_Y - 48 - GROUND_HEIGHT, width: 48, height: 48, speed: 0, type: 'shooter', shootTimer: 60 },
						{ x: 1050, y: 230, width: 48, height: 48, speed: 3, type: 'jumper', jumpTimer: 45, vy: 0, facingRight: true, animationFrame: 0 }
					];
					coins = [
						{ x: 150, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 450, y: 408, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 1050, y: 230, width: 36, height: 36 }
					];
					spikes = [
						{ x: 300, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 678, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 714, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 786, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 822, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 }
					];
					boxes = [
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36, broken: false }
					];
					platforms = [
						{ x: 400, y: 426, width: 72, height: PLATFORM_HEIGHT },
						{ x: 600, y: 346, width: 72, height: PLATFORM_HEIGHT },
						{ x: 850, y: 266, width: 72, height: PLATFORM_HEIGHT },
						{ x: 1000, y: 266, width: 36, height: PLATFORM_HEIGHT }
					];
					powerups = [
						{ x: 450, y: 376, width: 32, height: 32, type: 'speed' },
						{ x: 650, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 72, height: 72, type: 'killer' }
					];
					lockedDoors = [
						{ x: 714, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 750, y: GROUND_Y - 108 - GROUND_HEIGHT, width: 36, height: 36 },
						{ x: 1014, y: 230, width: 36, height: 36 },
						{ x: 1050, y: 194, width: 36, height: 36 },
						{ x: 1086, y: 230, width: 36, height: 36 },
						{ x: 600, y: 310, width: 36, height: 36 }
					];
					keys = [
						{ x: 300, y: 390, width: 36, height: 36 }, // Unlocks ground doors
						{ x: 650, y: 310, width: 36, height: 36 }, // Unlocks middle platform door
						{ x: 900, y: GROUND_Y - 36 - GROUND_HEIGHT, width: 36, height: 36 } // Unlocks elevated doors
					];
					TOTAL_COINS = 5; // 4 coins + 1 from box
				} else if (level === 10) {
					boss = {
						x: 550, y: GROUND_Y - 72 - GROUND_HEIGHT, width: 72, height: 72,
						speed: 3, type: 'boss', jumpTimer: 60, vy: 0, hp: 10, facingRight: true, animationFrame: 0
					};
					enemies = [boss];
					coins = [];
					spikes = [];
					boxes = [];
					platforms = [
						{ x: 200, y: 426, width: 108, height: PLATFORM_HEIGHT }, // Left
						{ x: 546, y: 346, width: 108, height: PLATFORM_HEIGHT }, // Middle
						{ x: 892, y: 426, width: 108, height: PLATFORM_HEIGHT }  // Right
					];
					powerups = [];
					lockedDoors = [];
					keys = [];
					rocks = [];
					powerupSpawnTimer = 0; 
					TOTAL_COINS = 1;
				}
			}

            coinCount = 0;
            transitionFrames = 0;
            hasWonSoundPlayed = false;
            particles = [];
            projectiles = [];
            rocks = [];
            confetti = [];
            levelDisplay.textContent = `Level: ${level}`;
            livesDisplay.textContent = `Lives: ${player.lives}`;
            coinsDisplay.textContent = `Coins: ${coinCount}`;
            isPaused = false;
            pauseButton.textContent = 'Pause';
            pauseButton.style.display = gameState === 'playing' ? 'inline' : 'none';
        }

        // Start the game loop
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
